{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ player.player.full_name }} | Player Stats</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 700px;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(40, 40, 40, 0.9);
            border-radius: 12px;
            box-shadow: 0 2px 16px #2228;
            border: 1px solid #404040;
            text-align: center;
            animation: fadeIn 0.4s;
        }
        .player-headshot {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #8b9dc3;
            background: #222;
            margin-bottom: 1rem;
        }
        h1 {
            color: #8b9dc3;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #555;
            padding-bottom: 0.5rem;
        }
        h2 {
            color: #e0e0e0;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        h3 {
            color: #b0b0b0;
            font-size: 1rem;
            margin: 1.2rem 0 0.5rem 0;
            font-weight: 500;
        }
        .player-link {
            color: #8b9dc3;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.2rem;
        }
        .player-link:hover {
            color: #a5b5d1;
            text-decoration: underline;
        }
        ul {
            list-style: none;
            padding: 0;
            margin: 0 auto 1.5rem auto;
            text-align: left;
            max-width: 420px;
        }
        li {
            padding: 0.3rem 0;
            border-bottom: 1px solid #333;
            font-size: 0.97rem;
        }
        strong {
            color: #9bb3d6;
        }
        hr {
            border: none;
            border-top: 1px solid #444;
            margin: 2rem 0 1rem 0;
        }
        .season-filter {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .season-select {
            padding: 0.4rem 0.8rem;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: #e0e0e0;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .season-section { display: none; }
        .season-section.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px);}
            to { opacity: 1; transform: translateY(0);}
        }
        @media (max-width: 600px) {
            .container { padding: 1rem; }
            .player-headshot { width: 80px; height: 80px; }
            ul { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container fade-in">
        <!-- Player Headshot -->
        <img class="player-headshot"
            src="https://fbref.com/req/202302030/images/headshots/{{ player.player.fbref_id }}_2022.jpg"
            alt="{{ player.player.name }} headshot"
            onerror="this.onerror=null; this.src='{% static 'images/default_headshot.jpeg' %}';"
        >

        <!-- Player Basic Info -->
        <h2>
            <a class="player-link" href="{% url 'player_detail' player_id=player.player.full_name %}">
                {{ player.player.full_name }}
            </a>
            (Age: {{ player.player.age }})
        </h2>
        <h1>Season Stats</h1>

        <!-- Season Filter Dropdown -->
        <div class="season-filter">
            <label for="season-select">Season:</label>
            <select id="season-select" class="season-select">
                {% for p in players %}
                    <option value="{{ p.season }}">{{ p.season }}</option>
                {% endfor %}
            </select>
        </div>

        {% if is_goalkeeper %}
            <h1>Goalkeeper Stats</h1>
            {% for gk in players %}
                <div class="season-section" data-season="{{ gk.season }}">
                    {% comment %} <h3>
                        <a class="player-link" href="{% url 'player_detail' player_id=gk.player.full_name %}">
                            {{ gk.player.full_name }}
                        </a> ({{ gk.season }})
                    </h3> {% endcomment %}
                    <ul>
                        <li><strong>Club</strong>: {{ gk.club.name }}</li>
                        <li><strong>Position</strong>: {{ gk.position }}</li>
                        <li><strong>Matches Played</strong>: {{ gk.matches_played }}</li>
                        <li><strong>Minutes Played</strong>: {{ gk.minutes_played }}</li>
                        <li><strong>Goals Conceded</strong>: {{ gk.goals_conceded }}</li>
                        <li><strong>Shots Faced</strong>: {{ gk.shots_faced }}</li>
                        <li><strong>Saves</strong>: {{ gk.saves }}</li>
                        <li><strong>Save Percentage</strong>: {{ gk.save_percentage|floatformat:"-1" }}%</li>
                        <li><strong>Clean Sheets</strong>: {{ gk.clean_sheets }}</li>
                        <li><strong>Post-Shot xG</strong>: {{ gk.psxg|floatformat:"-1" }}</li>
                        <li><strong>PSxG Performance</strong>: {{ gk.psxg_performance|floatformat:"-1" }}</li>
                        <li><strong>Penalties Saved</strong>: {{ gk.pen_saved }}</li>
                        <li><strong>Passes</strong>: {{ gk.passes }}</li>
                        <li><strong>Crosses Stopped</strong>: {{ gk.crosses_stopped }}</li>
                        <li><strong>Sweeper Actions</strong>: {{ gk.sweeper_action }}</li>
                        <li><strong>Sweeper Actions per 90</strong>: {{ gk.sweeper_action_per90|floatformat:"-1" }}</li>
                    </ul>
                    <hr>
                </div>
            {% endfor %}
        {% else %}
            {% for player in players %}
                <div class="season-section" data-season="{{ player.season }}">
                    {% comment %} <h3>
                        <a class="player-link" href="{% url 'player_detail' player_id=player.player.full_name %}">
                            {{ player.player.full_name }}
                        </a> ({{ player.season }})
                    </h3> {% endcomment %}
                    <ul>
                        <li><strong>Position</strong>: {{ player.position }}</li>
                        <li><strong>Minutes Played</strong>: {{ player.minutes_played }}</li>
                        <li><strong>Matches Played</strong>: {{ player.matches_played }}</li>
                        <li><strong>Matches Completed</strong>: {{ player.matches_completed }}</li>
                        <li><strong>Matches Substituted</strong>: {{ player.matches_substituted }}</li>
                        <li><strong>Unused Sub</strong>: {{ player.unused_sub }}</li>
                        <li><strong>Goals</strong>: {{ player.goals }}</li>
                        <li><strong>Assists</strong>: {{ player.assists }}</li>
                        <li><strong>G/A</strong>: {{ ga }}</li>
                        <li><strong>Expected Goals (xG)</strong>: {{ player.xg|floatformat:"-1" }}</li>
                        <li><strong>Non-Penalty Expected Goals (npxg)</strong>: {{ player.npxg|floatformat:"-1" }}</li>
                        <li><strong>xG Performance</strong>: {{ player.xg_performance|floatformat:"-1" }}</li>
                        <li><strong>npxg Performance</strong>: {{ player.npxg_performance|floatformat:"-1" }}</li>
                        <li><strong>Progressive Carries</strong>: {{ player.prog_carries }}</li>
                        <li><strong>Progressive Carries to Final 3rd</strong>: {{ player.prog_carries_final_3rd }}</li>
                        <li><strong>Progressive Passes</strong>: {{ player.prog_passes }}</li>
                        <li><strong>Shots on Target</strong>: {{ player.shots_target }}</li>
                        <li><strong>Passes to Final 3rd</strong>: {{ player.passes_to_final_3rd }}</li>
                        <li><strong>Passes to Penalty Area</strong>: {{ player.passes_to_pen_area }}</li>
                        <li><strong>Pass Switches</strong>: {{ player.pass_switches }}</li>
                        <li><strong>Through Balls</strong>: {{ player.through_ball }}</li>
                        <li><strong>Shot Creation Actions</strong>: {{ player.shots_creation_action }}</li>
                        <li><strong>Offsides</strong>: {{ player.offsides }}</li>
                        <li><strong>Penalties Won</strong>: {{ player.pen_won }}</li>
                        <li><strong>Penalties Conceded</strong>: {{ player.pen_conceded }}</li>
                        <li><strong>Tackles</strong>: {{ player.tackles }}</li>
                        <li><strong>Ball Recoveries</strong>: {{ player.ball_recoveries }}</li>
                        <li><strong>Aerial Duels Won</strong>: {{ player.aerial_duels_won }}</li>
                        <li><strong>Aerial Duels Lost</strong>: {{ player.aerial_duels_lost }}</li>
                        <li><strong>Blocks</strong>: {{ player.blocks }}</li>
                        <li><strong>Tackles Won</strong>: {{ player.tackles_won }}</li>
                        <li><strong>Interceptions</strong>: {{ player.interceptions }}</li>
                        <li><strong>Touches</strong>: {{ player.touches }}</li>
                        <li><strong>Dispossessed</strong>: {{ player.dispossessed }}</li>
                        <li><strong>Miscontrols</strong>: {{ player.miscontrols }}</li>
                        <li><strong>Take-Ons</strong>: {{ player.take_ons }}</li>
                        <li><strong>Take-Ons Won</strong>: {{ player.take_ons_won }}</li>
                        <li><strong>Fouls Won</strong>: {{ player.fouls_won }}</li>
                        <li><strong>Fouls Committed</strong>: {{ player.fouls_committed }}</li>
                        <li><strong>Carries to Final 3rd</strong>: {{ player.carries_to_final_3rd }}</li>
                        <li><strong>Carries to Penalty Area</strong>: {{ player.carries_to_pen_area }}</li>
                        <li><strong>Yellow Cards</strong>: {{ player.yellow_card }}</li>
                        <li><strong>Red Cards</strong>: {{ player.red_card }}</li>
                    </ul>
                    <hr>
                </div>
            {% endfor %}
        {% endif %}
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const select = document.getElementById('season-select');
            const sections = document.querySelectorAll('.season-section');
            function showSeason(season) {
                sections.forEach(sec => {
                    if (sec.getAttribute('data-season') === season) {
                        sec.classList.add('active');
                    } else {
                        sec.classList.remove('active');
                    }
                });
            }
            // Show first season by default
            if (select.value) showSeason(select.value);
            select.addEventListener('change', function() {
                showSeason(this.value);
            });
        });
    </script>
</body>
</html>
